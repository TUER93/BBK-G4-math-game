# 从 Render 下载数据指南

## 🎯 三种下载方法

---

## 方法 1：管理后台一键下载 ⭐（推荐）

### 步骤：

1. **访问管理后台**
   ```
   https://bbk-g4-math-game.onrender.com/admin.html
   ```

2. **输入密码**
   ```
   HUA967101
   ```

3. **点击顶部按钮下载**

   三个下载按钮的区别：

   | 按钮 | 文件内容 | 用途 |
   |------|---------|------|
   | **💾 下载数据文件** | 原始 `data.json` | 下载用户游戏数据（等级、元素、答题记录）|
   | **📦 备份数据** | 完整备份（含题目、学生） | 完整备份，可用于恢复 |
   | **📥 导出所有数据** | 格式化的完整数据 | 数据分析、查看、迁移 |

4. **文件自动下载到浏览器默认下载目录**

---

## 方法 2：直接访问下载链接

### 直接下载用户数据文件：

在浏览器中访问：
```
https://bbk-g4-math-game.onrender.com/api/admin/download-data
```

**说明**：
- ✅ 直接下载原始 `data.json` 文件
- ✅ 包含所有用户游戏数据
- ✅ 文件名格式：`data_2025-01-XX.json`

---

## 方法 3：使用 Render Shell

### 适用场景：
- 需要查看文件路径
- 需要手动操作文件
- 需要执行其他命令

### 步骤：

1. **登录 Render Dashboard**
   ```
   https://dashboard.render.com/
   ```

2. **选择服务**
   - 找到 `bbk-math-game` 服务
   - 点击服务名称

3. **打开 Shell**
   - 点击右上角的 `Shell` 按钮
   - 等待 Shell 启动

4. **查看数据文件**
   ```bash
   # 查看数据目录
   ls -lh /app/data/
   
   # 查看数据文件大小
   du -h /app/data/data.json
   
   # 查看数据文件内容
   cat /app/data/data.json
   ```

5. **复制数据**
   - 全选并复制输出的 JSON 内容
   - 粘贴到本地文本编辑器（VS Code、Notepad++）
   - 保存为 `data.json`

6. **查看格式化的数据（可选）**
   ```bash
   # 安装 jq（JSON 格式化工具）
   apt-get update && apt-get install -y jq
   
   # 格式化显示数据
   cat /app/data/data.json | jq .
   ```

---

## 📊 下载的数据包含什么？

### data.json 文件结构：

```json
{
  "users": [
    {
      "id": "1234567890",
      "className": "四(1)班",
      "name": "张三",
      "account": "zs001",
      "level": 5,
      "elements": {
        "fire": 2,
        "water": 15,
        "wind": 12,
        "rock": 10,
        "grass": 8,
        "thunder": 1,
        "ice": 3
      },
      "wrongQuestions": [],
      "answeredQuestions": [1, 2, 3, 5, 8],
      "answeredChallengeQuestions": [101],
      "statistics": {
        "totalQuestions": 20,
        "correctQuestions": 18,
        "accuracy": 90
      },
      "answerHistory": [],
      "dailyUsage": {
        "date": "Mon Jan 20 2025",
        "duration": 1200,
        "loginTime": 1737360000000
      }
    }
  ],
  "broadcasts": []
}
```

### 字段说明：

| 字段 | 说明 |
|------|------|
| `users` | 所有用户数组 |
| `id` | 用户唯一标识 |
| `className` | 班级 |
| `name` | 姓名 |
| `level` | 当前等级 |
| `elements` | 7种元素的数量 |
| `answeredQuestions` | 已答题目ID列表 |
| `statistics` | 答题统计数据 |
| `answerHistory` | 答题历史记录（最近100条）|
| `dailyUsage` | 每日使用时长 |

---

## 🔄 如何使用下载的数据？

### 用途 1：本地测试
```bash
# 将下载的 data.json 复制到项目根目录
cp data_2025-01-20.json "c:/Users/17227/CodeBuddy/bbk game/data.json"

# 启动本地服务器
npm start
```

### 用途 2：数据分析
- 使用 Excel/Python 分析学生答题情况
- 统计各班级平均等级
- 查看答题正确率分布

### 用途 3：数据恢复
如果线上数据出问题，可以：
1. 使用 Render Shell 上传备份文件
2. 或通过管理后台批量导入

### 用途 4：迁移到其他平台
- 直接复制 data.json 到新服务器
- 配置好 DATA_DIR 环境变量
- 数据无缝迁移

---

## 🛡️ 数据安全建议

### 定期备份策略：

| 频率 | 方法 |
|------|------|
| **每周** | 点击"💾 下载数据文件"备份 |
| **重大更新前** | 点击"📦 备份数据"完整备份 |
| **学期结束** | 导出所有数据并存档 |

### 备份存储位置：
- ✅ 本地电脑（多个位置）
- ✅ 云盘（百度网盘、OneDrive）
- ✅ U盘（重要备份）

---

## ⚠️ 常见问题

### Q1: 下载的数据文件很大怎么办？
**A:** 
- 正常情况：几百 KB 到几 MB
- 如果过大：可能包含大量答题历史
- 解决：在后台定期清理旧数据

### Q2: 下载失败怎么办？
**A:** 
1. 检查网络连接
2. 刷新页面重试
3. 使用其他浏览器
4. 使用方法 3（Render Shell）

### Q3: 数据文件是否包含密码？
**A:** 
- ❌ 不包含管理密码
- ✅ 包含学生账号（非密码）
- ✅ 数据相对安全

### Q4: 可以编辑下载的数据吗？
**A:** 
- ✅ 可以用文本编辑器编辑
- ⚠️ 必须保持 JSON 格式正确
- ⚠️ 修改后需要重新上传到服务器

---

## 📝 快速操作清单

### 每周备份操作（2分钟）：
1. [ ] 访问后台：https://bbk-g4-math-game.onrender.com/admin.html
2. [ ] 输入密码：`HUA967101`
3. [ ] 点击 `💾 下载数据文件`
4. [ ] 保存到备份文件夹
5. [ ] 完成！

### 紧急数据恢复：
1. [ ] 找到最近的备份文件
2. [ ] 登录 Render Shell
3. [ ] 上传备份文件到 `/app/data/data.json`
4. [ ] 重启服务

---

**建议：每周至少备份一次数据！** 💾
