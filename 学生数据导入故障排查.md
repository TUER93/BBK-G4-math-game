# 🔧 学生数据导入故障排查指南

## 📋 常见失败原因及解决方案

### 1️⃣ 数据格式错误 ❌

#### 问题表现:
- 提示"没有有效的数据"
- 提示"格式错误"

#### 解决方案:
✅ **正确格式** (用**逗号**分隔):
```
一班,张三,zs001
一班,李四,ls001
二班,王五,ww002
```

❌ **错误格式**:
```
一班 张三 zs001          (❌ 用空格分隔)
一班,张三                (❌ 缺少账号)
一班,,zs001             (❌ 姓名为空)
,张三,zs001             (❌ 班级为空)
```

#### 检查清单:
- [ ] 每行必须有3个字段: `班级,姓名,账号`
- [ ] 使用**英文逗号** `,` 分隔 (不是中文逗号`,`)
- [ ] 每个字段不能为空
- [ ] 没有多余的空行

---

### 2️⃣ 服务器未启动 🚫

#### 问题表现:
- 提示"导入失败"
- 控制台显示 "Failed to fetch" 或 "ERR_CONNECTION_REFUSED"

#### 解决方案:
1. 打开命令行/终端
2. 进入项目目录
3. 运行启动命令:
   ```bash
   npm start
   ```
4. 等待出现 "服务器运行在 http://localhost:3000"
5. 刷新管理后台页面

---

### 3️⃣ 端口冲突 ⚠️

#### 问题表现:
- 服务器启动失败
- 提示 "EADDRINUSE" 或 "端口已被占用"

#### 解决方案:
**方案A - 关闭占用端口的程序:**
```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID <进程号> /F

# Mac/Linux
lsof -i :3000
kill -9 <进程号>
```

**方案B - 更换端口:**
修改 `server.js`:
```javascript
const PORT = process.env.PORT || 3001;  // 改成3001
```

---

### 4️⃣ 网络请求被拦截 🛡️

#### 问题表现:
- 其他功能正常,导入失败
- 控制台显示 CORS 错误

#### 解决方案:
- 确保服务器正在运行
- 检查浏览器控制台的错误信息
- 尝试刷新页面 (Ctrl + F5)

---

### 5️⃣ 文件编码问题 📝

#### 问题表现:
- 从文件导入时中文显示乱码
- 导入后学生名字是乱码

#### 解决方案:
1. 用记事本打开 `.txt` 文件
2. 另存为 → 编码选择 **UTF-8**
3. 保存后重新导入

---

## 🧪 测试步骤

### Step 1: 测试简单数据
复制以下内容到导入框:
```
一班,测试学生,test001
```
点击"导入学生"

✅ **成功**: 提示"成功导入 1 个学生"
❌ **失败**: 继续下一步

### Step 2: 检查服务器
打开新终端/命令行:
```bash
npm start
```

✅ **成功**: 看到 "服务器运行在 http://localhost:3000"
❌ **失败**: 检查是否安装了依赖 (`npm install`)

### Step 3: 检查浏览器控制台
1. 按 `F12` 打开开发者工具
2. 切换到 "Console" (控制台) 标签
3. 点击"导入学生"
4. 查看红色错误信息

常见错误信息:
- `Failed to fetch` → 服务器未启动
- `404 Not Found` → API路径错误 (检查server.js)
- `500 Internal Server Error` → 服务器代码错误

---

## 🎯 最新改进 (已修复)

### ✅ 增强的错误提示
- 显示具体是哪一行数据有问题
- 提供详细的错误原因
- 给出格式示例

### ✅ 数据验证
- 检查字段是否完整
- 检查是否有空字段
- 支持部分数据导入 (跳过错误行)

### ✅ 更好的用户反馈
- 成功提示显示导入数量
- 失败提示显示具体原因
- 控制台输出详细日志

---

## 📞 仍然无法解决?

### 查看详细日志:
1. 打开浏览器控制台 (F12)
2. 切换到 Console 标签
3. 尝试导入数据
4. 截图错误信息

### 检查服务器日志:
1. 查看运行 `npm start` 的终端
2. 寻找红色错误信息
3. 截图错误信息

### 常用调试命令:
```bash
# 检查Node.js版本
node --version

# 检查npm版本
npm --version

# 重新安装依赖
rm -rf node_modules
npm install

# 检查端口占用
netstat -ano | findstr :3000   # Windows
lsof -i :3000                   # Mac/Linux
```

---

## 📝 数据格式参考

### 标准格式
```
班级,姓名,账号
```

### 批量示例
```
一班,张三,zs001
一班,李四,ls001
一班,王五,ww001
二班,赵六,zl002
二班,钱七,qq002
三班,孙八,sb003
```

### 字段说明
- **班级**: 学生所在班级,可以是任意文本
- **姓名**: 学生姓名
- **账号**: 登录账号,建议使用字母+数字,保持唯一

---

## ⚡ 快速恢复

如果数据导入后有问题,可以:

1. **删除错误数据**:
   - 在"学生管理"标签页逐个删除

2. **重置所有数据**:
   - 删除 `students.json` 文件
   - 重启服务器 (会自动创建新的空文件)

3. **恢复备份**:
   - 如果之前做过备份,直接替换 `students.json`
